<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OverflowPreventer - æµ‹è¯•é¡µé¢</title>
  <link rel="stylesheet" href="overflow-preventer.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }

    .control-panel {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .control-panel h2 {
      margin-bottom: 15px;
      color: #333;
    }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .controls button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .controls button:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .btn-primary { background: #007bff; color: white; }
    .btn-success { background: #28a745; color: white; }
    .btn-warning { background: #ffc107; color: black; }
    .btn-danger { background: #dc3545; color: white; }
    .btn-info { background: #17a2b8; color: white; }

    .stats {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 13px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .stat-item {
      background: white;
      padding: 10px;
      border-radius: 4px;
      border-left: 3px solid #007bff;
    }

    .stat-label {
      color: #666;
      font-size: 11px;
      text-transform: uppercase;
    }

    .stat-value {
      font-size: 18px;
      font-weight: bold;
      color: #333;
      margin-top: 5px;
    }

    .test-container {
      width: 800px;
      height: 600px;
      background: white;
      border: 3px solid #007bff;
      margin: 20px auto;
      position: relative;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }

    .test-content {
      padding: 20px;
    }

    .violation-list {
      background: white;
      padding: 20px;
      margin-top: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      max-height: 400px;
      overflow-y: auto;
    }

    .violation-item {
      padding: 10px;
      margin-bottom: 10px;
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
    }

    .violation-item.fixed {
      background: #d4edda;
      border-left-color: #28a745;
    }

    /* æµ‹è¯•å…ƒç´ æ ·å¼ */
    .big-text {
      font-size: 100px;
      font-weight: bold;
      color: #dc3545;
    }

    .wide-box {
      width: 2000px;
      height: 100px;
      background: linear-gradient(to right, #667eea 0%, #764ba2 100%);
      margin: 10px 0;
    }

    .tall-box {
      width: 100px;
      height: 1000px;
      background: linear-gradient(to bottom, #f093fb 0%, #f5576c 100%);
      margin: 10px 0;
    }

    .absolute-box {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 500px;
      height: 500px;
      background: rgba(255, 0, 0, 0.3);
      border: 2px solid red;
    }

    .long-text {
      white-space: nowrap;
      font-size: 24px;
    }

    .table-overflow {
      width: 150%;
      border-collapse: collapse;
    }

    .table-overflow td {
      border: 1px solid #ddd;
      padding: 8px;
    }
  </style>
</head>
<body>
  <div class="control-panel">
    <h2>ğŸš€ OverflowPreventer - æ§åˆ¶é¢æ¿</h2>

    <div class="controls">
      <button class="btn-primary" onclick="initPreventer('strict')">
        ğŸ”’ å¯åŠ¨ (ä¸¥æ ¼æ¨¡å¼)
      </button>
      <button class="btn-success" onclick="initPreventer('auto-fix')">
        ğŸ”§ å¯åŠ¨ (è‡ªåŠ¨ä¿®å¤)
      </button>
      <button class="btn-warning" onclick="initPreventer('warn')">
        âš ï¸ å¯åŠ¨ (ä»…è­¦å‘Š)
      </button>
      <button class="btn-danger" onclick="stopPreventer()">
        â¹ï¸ åœæ­¢
      </button>
      <button class="btn-info" onclick="forceCheck()">
        ğŸ”„ å¼ºåˆ¶æ£€æŸ¥
      </button>
    </div>

    <div class="controls">
      <button class="btn-primary" onclick="addBigText()">
        â• æ·»åŠ è¶…å¤§æ–‡æœ¬
      </button>
      <button class="btn-primary" onclick="addWideBox()">
        â• æ·»åŠ è¶…å®½ç›’å­
      </button>
      <button class="btn-primary" onclick="addTallBox()">
        â• æ·»åŠ è¶…é«˜ç›’å­
      </button>
      <button class="btn-primary" onclick="addAbsoluteBox()">
        â• æ·»åŠ ç»å¯¹å®šä½
      </button>
      <button class="btn-danger" onclick="clearContent()">
        ğŸ—‘ï¸ æ¸…ç©ºå†…å®¹
      </button>
    </div>

    <div class="stats">
      <h3>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h3>
      <div class="stats-grid" id="stats"></div>
    </div>
  </div>

  <div class="test-container" id="container">
    <div class="test-content" id="content">
      <h1>æµ‹è¯•å®¹å™¨ (800x600)</h1>
      <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ å¯èƒ½å¯¼è‡´ overflow çš„å…ƒç´ ï¼Œè§‚å¯Ÿ OverflowPreventer å¦‚ä½•ä¸»åŠ¨é˜²æ­¢æº¢å‡ºã€‚</p>
    </div>
  </div>

  <div class="violation-list">
    <h3>âš ï¸ è¿è§„è®°å½•</h3>
    <div id="violations"></div>
  </div>

  <script src="overflow-preventer.js"></script>
  <script>
    let preventer = null;

    // åˆå§‹åŒ– Preventer
    function initPreventer(mode) {
      if (preventer) {
        preventer.destroy();
      }

      const container = document.getElementById('container');
      preventer = new OverflowPreventer(container, {
        mode: mode,
        enableLogs: true,
        autoResize: true,
        checkInterval: 100,
        excludeSelectors: []
      });

      updateStats();
      updateViolations();

      // å®šæœŸæ›´æ–°ç»Ÿè®¡
      setInterval(updateStats, 500);
      setInterval(updateViolations, 1000);

      showNotification(`å·²å¯åŠ¨ OverflowPreventer (${mode} æ¨¡å¼)`, 'success');
    }

    // åœæ­¢ Preventer
    function stopPreventer() {
      if (preventer) {
        preventer.stop();
        showNotification('å·²åœæ­¢ OverflowPreventer', 'warning');
      }
    }

    // å¼ºåˆ¶æ£€æŸ¥
    function forceCheck() {
      if (preventer) {
        preventer.forceCheck();
        updateStats();
        updateViolations();
        showNotification('å·²å®Œæˆå¼ºåˆ¶æ£€æŸ¥', 'info');
      }
    }

    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    function updateStats() {
      if (!preventer) return;

      const stats = preventer.getStats();
      const statsEl = document.getElementById('stats');

      statsEl.innerHTML = `
        <div class="stat-item">
          <div class="stat-label">çŠ¶æ€</div>
          <div class="stat-value">${stats.isActive ? 'ğŸŸ¢ è¿è¡Œä¸­' : 'ğŸ”´ å·²åœæ­¢'}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æ€»æ£€æŸ¥æ¬¡æ•°</div>
          <div class="stat-value">${stats.totalChecks}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æ£€æµ‹åˆ°è¿è§„</div>
          <div class="stat-value">${stats.violations}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">è‡ªåŠ¨ä¿®å¤</div>
          <div class="stat-value">${stats.fixes}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¼ºåˆ¶é˜»æ–­</div>
          <div class="stat-value">${stats.prevented}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å½“å‰è¿è§„</div>
          <div class="stat-value">${stats.currentViolations}</div>
        </div>
      `;
    }

    // æ›´æ–°è¿è§„åˆ—è¡¨
    function updateViolations() {
      if (!preventer) return;

      const violations = preventer.getViolations();
      const violationsEl = document.getElementById('violations');

      if (violations.length === 0) {
        violationsEl.innerHTML = '<p style="color: #28a745;">âœ… æ²¡æœ‰æ£€æµ‹åˆ° overflow è¿è§„</p>';
        return;
      }

      violationsEl.innerHTML = violations.map(v => {
        const overflow = v.overflow;
        const el = v.element;
        const tag = el.tagName.toLowerCase();
        const id = el.id ? `#${el.id}` : '';
        const classes = el.className ? `.${el.className.split(' ').join('.')}` : '';

        return `
          <div class="violation-item ${v.fixed ? 'fixed' : ''}">
            <strong>&lt;${tag}${id}${classes}&gt;</strong><br>
            ä¸Š: ${overflow.top.toFixed(1)}px,
            å·¦: ${overflow.left.toFixed(1)}px,
            å³: ${overflow.right.toFixed(1)}px,
            ä¸‹: ${overflow.bottom.toFixed(1)}px
            ${v.fixed ? ' <span style="color: #28a745;">âœ“ å·²ä¿®å¤</span>' : ''}
          </div>
        `;
      }).join('');
    }

    // æ·»åŠ æµ‹è¯•å…ƒç´ 
    function addBigText() {
      const content = document.getElementById('content');
      const div = document.createElement('div');
      div.className = 'big-text';
      div.textContent = 'è¶…å¤§æ–‡æœ¬ï¼';
      content.appendChild(div);
      showNotification('å·²æ·»åŠ è¶…å¤§æ–‡æœ¬', 'info');
    }

    function addWideBox() {
      const content = document.getElementById('content');
      const div = document.createElement('div');
      div.className = 'wide-box';
      content.appendChild(div);
      showNotification('å·²æ·»åŠ è¶…å®½ç›’å­ (2000px)', 'info');
    }

    function addTallBox() {
      const content = document.getElementById('content');
      const div = document.createElement('div');
      div.className = 'tall-box';
      content.appendChild(div);
      showNotification('å·²æ·»åŠ è¶…é«˜ç›’å­ (1000px)', 'info');
    }

    function addAbsoluteBox() {
      const container = document.getElementById('container');
      const div = document.createElement('div');
      div.className = 'absolute-box';
      div.textContent = 'ç»å¯¹å®šä½ç›’å­';
      container.appendChild(div);
      showNotification('å·²æ·»åŠ ç»å¯¹å®šä½å…ƒç´ ', 'info');
    }

    function clearContent() {
      const content = document.getElementById('content');
      content.innerHTML = `
        <h1>æµ‹è¯•å®¹å™¨ (800x600)</h1>
        <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ å¯èƒ½å¯¼è‡´ overflow çš„å…ƒç´ ï¼Œè§‚å¯Ÿ OverflowPreventer å¦‚ä½•ä¸»åŠ¨é˜²æ­¢æº¢å‡ºã€‚</p>
      `;

      // ç§»é™¤ç»å¯¹å®šä½å…ƒç´ 
      const absBoxes = document.querySelectorAll('.absolute-box');
      absBoxes.forEach(box => box.remove());

      showNotification('å·²æ¸…ç©ºå†…å®¹', 'info');
    }

    // é€šçŸ¥
    function showNotification(message, type) {
      console.log(`[${type.toUpperCase()}] ${message}`);
    }

    // è‡ªåŠ¨å¯åŠ¨ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰
    window.addEventListener('load', () => {
      initPreventer('strict');
    });
  </script>
</body>
</html>
